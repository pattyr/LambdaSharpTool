Version: "2018-07-04"

Name: LambdaSharpRollbar

Description: LambdaSharp's custom resource handler for Rollbar resources

Variables:
  PostServerItem:
    Prompt: "Enter the `post_server_item` token for the `{{Deployment}}-LambdaSharpRollbar` Rollbar project:"
    Encrypt: LambdaSharp/SecretsKey
  ReadAccessToken:
    Prompt: "Enter the `read` access token for the Rollbar account:"
    Encrypt: LambdaSharp/SecretsKey
  WriteAccessToken:
    Prompt: "Enter the `write` access token for the Rollbar account:"
    Encrypt: LambdaSharp/SecretsKey

Secrets:
  - LambdaSharp/SecretsKey

Parameters:

  - Name: RollbarToken
    Description: Rollbar project for custom resource handler
    Secret: "{{PostServerItem}}"

  - Name: ReadAccessToken
    Description: Account-level token for read operations
    Secret: "{{ReadAccessToken}}"

  - Name: WriteAccessToken
    Description: Account-level token for write operations
    Secret: "{{WriteAccessToken}}"

  - Name: RollbarProjectCustomResourceTopic
    Description: Custom resource topic for Rollbar projects
    Export: /{{Deployment}}/LambdaSharp/RollbarProjectCustomResourceTopic
    Resource:
      Type: AWS::SNS::Topic
      Allow: Subscribe

Functions:

  - Name: ResourceHandler
    Description: Handle custom Rollbar resource requests to create, update, and delete projects
    Memory: 128
    Timeout: 30
    Sources:
      - Topic: RollbarProjectCustomResourceTopic
